name: Deploy n8n Workflow

# Trigger only when your n8n workflow JSON changes on master
on:
  push:
    branches:
      - master
    paths:
      - 'n8n-email-automation-webhook.json'

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      #  Checkout the repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      #  Import the workflow into the running n8n container
      - name: Import workflow into n8n container
        run: |
          echo "Importing workflow into n8n container..."
          docker cp n8n-email-automation-webhook.json $(docker compose ps -q n8n):/tmp/
          docker compose exec -T n8n n8n import:workflow --input /tmp/n8n-email-automation-webhook.json
          docker compose exec -T n8n rm /tmp/n8n-email-automation-webhook.json
